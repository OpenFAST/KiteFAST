# KiteMain.mbd


module load: "libmodule-kitefastmbd-os";


begin: data;
    problem: initial value;
end: data;


begin: initial value;
    initial time: 0.0;
    final time: 10.0;
    time step: 1e-3;
    tolerance: 1e-3;
    max iterations: 60;
    derivatives tolerance: 10e0;
    derivatives max iterations: 200;
    derivatives coefficient: 1e-4;
    linear solver: naive, colamd, mt, 1, pivot factor, 1e-8;
    # output: iterations;
    # output: residual;
end: initial value;


begin: control data;
    print: all;
    default orientation: orientation vector;

    include: "KiteMain.set";

    structural nodes:
      + 4  # platform
    ;

    set: integer body_count = 0;

    set: integer beam_count = 0;

    rigid bodies: 1;
    beams: beam_count;
    joints: 3;
    gravity;
    loadable elements: 1;
    #forces: 1;
end: control data;


begin: nodes;
    include: "platform.nodes";
end: nodes;


begin: elements;

    gravity: uniform,   0.000,   0.000,   1.000, const, -9.81;

    body: 1, platform_root_node,
        7.130400E+05,
        reference, node,   0.000,   0.000,   -29.06151,
        sym,    2.452533E+08,      0.000,      0.000,
                            2.452513E+08,      0.000,
                                        1.534000E+06;

    inertia: 1, body, all;

    #force: 1, absolute, platform_root_node, 0.0, 0.0, 1.0, null, const, 7.453E+06;

    joint: 1, total joint,
        platform_root_node + 0,
        platform_root_node + 1,
            position, reference, other node, null,
            rotation orientation, reference, other node, eye,
        position constraint,
            active, active, active,
            null,
        orientation constraint,
            active, active, active,
            null;

    joint: 2, total joint,
        platform_root_node + 0,
        platform_root_node + 2,
            position, reference, other node, null,
            rotation orientation, reference, other node, eye,
        position constraint,
            active, active, active,
            null,
        orientation constraint,
            active, active, active,
            null;

    joint: 3, total joint,
        platform_root_node + 0,
        platform_root_node + 3,
            position, reference, other node, null,
            rotation orientation, reference, other node, eye,
        position constraint,
            active, active, active,
            null,
        orientation constraint,
            active, active, active,
            null;

    user defined: 1, ModuleKiteFASTOS,
        simulation_type,
            3,
        fast_submodule_flags,
            0,
            0,
            0,
            0,
            1,
            0,
        fast_submodule_input_files,
            "simple_m600_model.inp",
            "kiteInflowWind.dat",
            "m600-MoorDyn.dat",
            "../../../../build/modules-local/kitefast-controller/libkitefastcontroller_controller.so",
            "hydrodyn.inp",
            "moordyn_mooring.inp",
        output_file_root,
            "KiteFast",
        print_kitefast_summary_file,
            0,
        time_step,
            1e-3,
        time_max,
            10.0,
        gravity,
            9.81,
        kiteaerodyn_interpolation_order,
            0,
        number_of_flaps_per_wing,
            0,
        number_of_pylons_per_wing,
            0,
        number_of_kite_components,
            0,
        keypoints,
        mip_node,
            platform_root_node + 0,
        platform_node,
            platform_root_node + 0,
        platform_imu_node,
            platform_root_node + 1,
        wind_reference_station_node,
            platform_root_node + 2,
        ground_station_node,
            platform_root_node + 3,
        fuselage,
            0,
        wing_starboard,
            0,
        wing_port,
            0,
        vertical_stabilizer,
            0,
        horizontal_stabilizer_starboard,
            0,
        horizontal_stabilizer_port,
            0,
        starboard_rotors,
            0,
        port_rotors,
            0,
        starboard_rotor_properties,
        port_rotor_properties,
        fuselage_outputs,
            0,
        wing_starboard_outputs,
            0,
        wing_port_outputs,
            0,
        vertical_stabilizer_outputs,
            0,
        horizontal_stabilizer_starboard_outputs,
            0,
        horizontal_stabilizer_port_outputs,
            0,
        pylon_outputs,
            0,
        output_channels,
            0;
end: elements;

